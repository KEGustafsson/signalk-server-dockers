From 91db03ea72852336ef91c3ad59447f95631fe890 Mon Sep 17 00:00:00 2001
From: Karl-Erik Gustafsson <ke.gustafsson@gmail.com>
Date: Wed, 11 Jun 2025 23:28:36 +0300
Subject: [PATCH 1/8] feat: ws devices use description as a name instead of id

---
 .../src/views/Dashboard/Dashboard.js          | 19 ++++++++++++++-----
 src/deltastats.ts                             |  7 +++++--
 2 files changed, 19 insertions(+), 7 deletions(-)

diff --git a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
index 403322a22..d00347095 100644
--- a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
+++ b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
@@ -17,13 +17,15 @@ const Dashboard = (props) => {
     numberOfAvailablePaths,
     wsClients,
     providerStatistics,
-    uptime
+    uptime,
+    devices,
   } = props.serverStatistics || {
     deltaRate: 0,
     numberOfAvailablePaths: 0,
     wsClients: 0,
     providerStatistics: {},
-    uptime: ''
+    uptime: '',
+    devices: []
   }
   const providerStatus = props.providerStatus || []
   const errorCount = providerStatus.filter((s) => s.type === 'error').length
@@ -66,6 +68,13 @@ const Dashboard = (props) => {
   }
 
   const renderActivity = (providerId, providerStats, linkType) => {
+    let device = providerId
+    if (providerId.startsWith('ws.')) {
+      const found = devices.find(
+        (d) => d.clientId === providerId.slice(3)
+      )
+      device = found && found.description ? found.description : providerId
+    }
     return (
       <li key={providerId} onClick={() => props.history.push(`/dashboard`)}>
         <i
@@ -84,7 +93,7 @@ const Dashboard = (props) => {
         <span className="title">
           {linkType === 'plugin'
             ? pluginNameLink(providerId)
-            : providerIdLink(providerId)}
+            : providerIdLink(providerId, device)}
         </span>
         {providerStats.writeRate > 0 && (
           <span className="value">
@@ -285,11 +294,11 @@ function pluginNameLink(id) {
   return <a href={'#/serverConfiguration/plugins/' + id}>{id}</a>
 }
 
-function providerIdLink(id) {
+function providerIdLink(id, name) {
   if (id === 'defaults') {
     return <a href={'#/serverConfiguration/settings'}>{id}</a>
   } else if (id.startsWith('ws.')) {
-    return <a href={'#/security/devices'}>{id}</a>
+    return <a href={'#/security/devices'}>{name}</a>
   } else {
     return <a href={'#/serverConfiguration/connections/' + id}>{id}</a>
   }
diff --git a/src/deltastats.ts b/src/deltastats.ts
index d59ede8da..0fa0e998d 100644
--- a/src/deltastats.ts
+++ b/src/deltastats.ts
@@ -17,7 +17,7 @@
 
 import { isUndefined, values } from 'lodash'
 import { EventEmitter } from 'node:events'
-
+import { getSecurityConfig } from './security'
 const STATS_UPDATE_INTERVAL_SECONDS = 5
 export const CONNECTION_WRITE_EVENT_NAME = 'connectionwrite'
 
@@ -73,6 +73,8 @@ export function startDeltaStatistics(
   return setInterval(() => {
     updateProviderPeriodStats(app)
     const anyApp = app as any
+    const config = getSecurityConfig(anyApp)
+    const devices = anyApp.securityStrategy.getDevices(config)
     app.emit('serverevent', {
       type: 'SERVERSTATISTICS',
       from: 'signalk-server',
@@ -83,7 +85,8 @@ export function startDeltaStatistics(
         numberOfAvailablePaths: anyApp.streambundle.getAvailablePaths().length,
         wsClients: anyApp.interfaces.ws ? anyApp.interfaces.ws.numClients() : 0,
         providerStatistics: app.providerStatistics,
-        uptime: process.uptime()
+        uptime: process.uptime(),
+        devices: devices
       }
     })
     app.lastIntervalDeltaCount = app.deltaCount

From cde66d8d2439d6f7d74fa0d02c6a8da4e4ef57b4 Mon Sep 17 00:00:00 2001
From: Karl-Erik Gustafsson <ke.gustafsson@gmail.com>
Date: Thu, 12 Jun 2025 01:18:15 +0300
Subject: [PATCH 2/8] fix: ensure devices are retrieved safely from security
 strategy

---
 src/deltastats.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/deltastats.ts b/src/deltastats.ts
index 0fa0e998d..ac00e1ec3 100644
--- a/src/deltastats.ts
+++ b/src/deltastats.ts
@@ -74,7 +74,10 @@ export function startDeltaStatistics(
     updateProviderPeriodStats(app)
     const anyApp = app as any
     const config = getSecurityConfig(anyApp)
-    const devices = anyApp.securityStrategy.getDevices(config)
+    let devices = [];
+    if ( anyApp && anyApp.securityStrategy && typeof anyApp.securityStrategy.getDevices === 'function' ) {
+      devices = anyApp.securityStrategy.getDevices(config);
+    }
     app.emit('serverevent', {
       type: 'SERVERSTATISTICS',
       from: 'signalk-server',

From a747a8087438294483f2e4ba079d211ef92af068 Mon Sep 17 00:00:00 2001
From: Karl-Erik Gustafsson <ke.gustafsson@gmail.com>
Date: Thu, 12 Jun 2025 01:25:14 +0300
Subject: [PATCH 3/8] fix: formatting

---
 .../server-admin-ui/src/views/Dashboard/Dashboard.js   |  6 ++----
 src/deltastats.ts                                      | 10 +++++++---
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
index d00347095..e832159f8 100644
--- a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
+++ b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
@@ -18,7 +18,7 @@ const Dashboard = (props) => {
     wsClients,
     providerStatistics,
     uptime,
-    devices,
+    devices
   } = props.serverStatistics || {
     deltaRate: 0,
     numberOfAvailablePaths: 0,
@@ -70,9 +70,7 @@ const Dashboard = (props) => {
   const renderActivity = (providerId, providerStats, linkType) => {
     let device = providerId
     if (providerId.startsWith('ws.')) {
-      const found = devices.find(
-        (d) => d.clientId === providerId.slice(3)
-      )
+      const found = devices.find((d) => d.clientId === providerId.slice(3))
       device = found && found.description ? found.description : providerId
     }
     return (
diff --git a/src/deltastats.ts b/src/deltastats.ts
index ac00e1ec3..9e167b1bd 100644
--- a/src/deltastats.ts
+++ b/src/deltastats.ts
@@ -74,9 +74,13 @@ export function startDeltaStatistics(
     updateProviderPeriodStats(app)
     const anyApp = app as any
     const config = getSecurityConfig(anyApp)
-    let devices = [];
-    if ( anyApp && anyApp.securityStrategy && typeof anyApp.securityStrategy.getDevices === 'function' ) {
-      devices = anyApp.securityStrategy.getDevices(config);
+    let devices = []
+    if (
+      anyApp &&
+      anyApp.securityStrategy &&
+      typeof anyApp.securityStrategy.getDevices === 'function'
+    ) {
+      devices = anyApp.securityStrategy.getDevices(config)
     }
     app.emit('serverevent', {
       type: 'SERVERSTATISTICS',

From 73ab51300a5f027b970a6ec479422b41cf9bd264 Mon Sep 17 00:00:00 2001
From: KE Gustafsson <ke.gustafsson@gmail.com>
Date: Thu, 11 Dec 2025 16:04:57 +0200
Subject: [PATCH 4/8] feat: use human readable ws device names all places

---
 .../src/utils/wsDeviceUtils.js                | 117 ++++++++++++++++++
 .../src/views/Dashboard/Dashboard.js          |  14 +--
 .../src/views/DataBrowser/DataBrowser.js      |  12 +-
 .../views/ServerConfig/SourcePriorities.js    |  19 ++-
 src/deltastats.ts                             |  13 +-
 5 files changed, 157 insertions(+), 18 deletions(-)
 create mode 100644 packages/server-admin-ui/src/utils/wsDeviceUtils.js

diff --git a/packages/server-admin-ui/src/utils/wsDeviceUtils.js b/packages/server-admin-ui/src/utils/wsDeviceUtils.js
new file mode 100644
index 000000000..35338617a
--- /dev/null
+++ b/packages/server-admin-ui/src/utils/wsDeviceUtils.js
@@ -0,0 +1,117 @@
+/**
+ * Utility functions for WebSocket device name resolution
+ *
+ * WS device IDs have the format "ws.{clientId}" where the clientId
+ * may have dots replaced with underscores. These IDs are not
+ * user-friendly, so we provide utilities to resolve them to
+ * human-readable device descriptions when available.
+ *
+ * Note: Delta $source can be composite like "ws.device_id.nmea0183.GGA"
+ * where the device part is followed by additional source path info.
+ */
+
+/**
+ * Converts a device clientId to the format used in WS source IDs
+ * by replacing dots with underscores.
+ *
+ * @param {string} clientId - The device clientId (e.g., "my.device.id")
+ * @returns {string} The WS format (e.g., "my_device_id")
+ */
+export function clientIdToWsFormat(clientId) {
+  if (!clientId) return ''
+  return clientId.replace(/\./g, '_')
+}
+
+/**
+ * Finds a device that matches the given WS source ID.
+ * The source ID may be composite (e.g., "ws.device_id.nmea0183.GGA")
+ * so we check if any device's clientId matches as a prefix.
+ *
+ * @param {string} wsSourceId - The WS source ID (e.g., "ws.device_id" or "ws.device_id.path.info")
+ * @param {Array} devices - Array of device objects with clientId property
+ * @returns {Object|null} The matching device or null
+ */
+export function findDeviceByWsSource(wsSourceId, devices) {
+  if (
+    !wsSourceId ||
+    !wsSourceId.startsWith('ws.') ||
+    !devices ||
+    !Array.isArray(devices)
+  ) {
+    return null
+  }
+
+  // Get the part after "ws."
+  const sourceWithoutPrefix = wsSourceId.slice(3)
+
+  // Find a device whose clientId (in ws format) matches the start of the source
+  for (const device of devices) {
+    if (device && device.clientId) {
+      const wsFormatClientId = clientIdToWsFormat(device.clientId)
+      // Check if source starts with this device's ID
+      // Must be exact match or followed by a dot (to avoid partial matches)
+      if (
+        sourceWithoutPrefix === wsFormatClientId ||
+        sourceWithoutPrefix.startsWith(wsFormatClientId + '.')
+      ) {
+        return device
+      }
+    }
+  }
+
+  return null
+}
+
+/**
+ * Gets the display name for a WebSocket source ID.
+ * Returns the device description if available, otherwise the original ID.
+ *
+ * @param {string} wsSourceId - The WebSocket source ID (e.g., "ws.device_id" or "ws.device_id.path")
+ * @param {Array} devices - Array of device objects with clientId and description
+ * @returns {string} The display name (description or original ID)
+ */
+export function getWsDeviceDisplayName(wsSourceId, devices) {
+  if (!wsSourceId || !wsSourceId.startsWith('ws.')) {
+    return wsSourceId
+  }
+
+  const device = findDeviceByWsSource(wsSourceId, devices)
+
+  // Return description if it exists and is not empty
+  if (device && device.description && device.description.trim() !== '') {
+    return device.description
+  }
+
+  return wsSourceId
+}
+
+/**
+ * Gets the display name for any source ID, handling both WS and non-WS sources.
+ * For WS sources, attempts to resolve to device description.
+ * For non-WS sources, returns the ID as-is.
+ *
+ * @param {string} sourceId - The source ID (e.g., "ws.client_123" or "nmea0183-1")
+ * @param {Array} devices - Array of device objects (can be null/undefined)
+ * @returns {string} The display name
+ */
+export function getSourceDisplayName(sourceId, devices) {
+  if (!sourceId) {
+    return sourceId
+  }
+
+  if (sourceId.startsWith('ws.')) {
+    return getWsDeviceDisplayName(sourceId, devices)
+  }
+
+  return sourceId
+}
+
+/**
+ * Checks if a source/provider ID is a WebSocket device
+ *
+ * @param {string} id - The source or provider ID
+ * @returns {boolean} True if it's a WebSocket device ID
+ */
+export function isWsDevice(id) {
+  return id && typeof id === 'string' && id.startsWith('ws.')
+}
diff --git a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
index e832159f8..c716e6a9d 100644
--- a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
+++ b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
@@ -10,6 +10,7 @@ import {
   Table
 } from 'reactstrap'
 import '../../fa-pulse.css'
+import { getWsDeviceDisplayName } from '../../utils/wsDeviceUtils'
 
 const Dashboard = (props) => {
   const {
@@ -68,11 +69,7 @@ const Dashboard = (props) => {
   }
 
   const renderActivity = (providerId, providerStats, linkType) => {
-    let device = providerId
-    if (providerId.startsWith('ws.')) {
-      const found = devices.find((d) => d.clientId === providerId.slice(3))
-      device = found && found.description ? found.description : providerId
-    }
+    const displayName = getWsDeviceDisplayName(providerId, devices)
     return (
       <li key={providerId} onClick={() => props.history.push(`/dashboard`)}>
         <i
@@ -91,7 +88,7 @@ const Dashboard = (props) => {
         <span className="title">
           {linkType === 'plugin'
             ? pluginNameLink(providerId)
-            : providerIdLink(providerId, device)}
+            : providerIdLink(providerId, displayName)}
         </span>
         {providerStats.writeRate > 0 && (
           <span className="value">
@@ -129,6 +126,7 @@ const Dashboard = (props) => {
   }
 
   const renderStatus = (status, statusClass, lastError) => {
+    const displayName = getWsDeviceDisplayName(status.id, devices)
     return (
       <tr
         key={status.id}
@@ -143,7 +141,7 @@ const Dashboard = (props) => {
         <td>
           {status.statusType === 'plugin'
             ? pluginNameLink(status.id)
-            : providerIdLink(status.id)}
+            : providerIdLink(status.id, displayName)}
         </td>
         <td>
           <p className="text-danger">{lastError}</p>
@@ -151,7 +149,7 @@ const Dashboard = (props) => {
         <td>
           <p className={statusClass}>
             {(status.message || '').substring(0, 80)}
-            {status.message.length > 80 ? '...' : ''}
+            {(status.message || '').length > 80 ? '...' : ''}
           </p>
         </td>
       </tr>
diff --git a/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js b/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
index 69494284e..759f60184 100644
--- a/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
+++ b/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
@@ -17,6 +17,7 @@ import moment from 'moment'
 import { CopyToClipboard } from 'react-copy-to-clipboard'
 import Meta from './Meta'
 import { getValueRenderer, DefaultValueRenderer } from './ValueRenderers'
+import { getSourceDisplayName } from '../../utils/wsDeviceUtils'
 
 const TIMESTAMP_FORMAT = 'MM/DD HH:mm:ss'
 const TIME_ONLY_FORMAT = 'HH:mm:ss'
@@ -690,7 +691,11 @@ class DataBrowser extends Component {
                                   }}
                                 />
                                 <CopyToClipboardWithFade text={data.$source}>
-                                  {data.$source} <i className="far fa-copy"></i>
+                                  {getSourceDisplayName(
+                                    data.$source,
+                                    this.props.serverStatistics?.devices
+                                  )}{' '}
+                                  <i className="far fa-copy"></i>
                                 </CopyToClipboardWithFade>{' '}
                                 {data.pgn || ''}
                                 {data.sentence || ''}
@@ -850,4 +855,7 @@ class CopyToClipboardWithFade extends Component {
   }
 }
 
-export default connect(({ webSocket }) => ({ webSocket }))(DataBrowser)
+export default connect(({ webSocket, serverStatistics }) => ({
+  webSocket,
+  serverStatistics
+}))(DataBrowser)
diff --git a/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js b/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
index 20f5c49c5..5b3d1992a 100644
--- a/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
+++ b/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
@@ -15,6 +15,7 @@ import {
 import Creatable from 'react-select/creatable'
 import remove from 'lodash.remove'
 import uniq from 'lodash.uniq'
+import { getSourceDisplayName } from '../../utils/wsDeviceUtils'
 
 export const SOURCEPRIOS_PRIO_CHANGED = 'SOURCEPRIOS_PPRIO_CHANGED'
 export const SOURCEPRIOS_PRIO_DELETED = 'SOURCEPRIOS_PRIO_DELETED'
@@ -189,10 +190,14 @@ class PrefsEditor extends Component {
             <tbody>
               {[...this.props.priorities, { sourceRef: '', timeout: '' }].map(
                 ({ sourceRef, timeout }, index) => {
-                  const options = this.state.sourceRefs.map((sourceRef) => ({
-                    label: sourceRef,
-                    value: sourceRef
+                  const options = this.state.sourceRefs.map((ref) => ({
+                    label: getSourceDisplayName(ref, this.props.devices),
+                    value: ref
                   }))
+                  const selectedLabel = getSourceDisplayName(
+                    sourceRef,
+                    this.props.devices
+                  )
                   return (
                     <tr key={index}>
                       <td>{index + 1}.</td>
@@ -200,7 +205,7 @@ class PrefsEditor extends Component {
                         <Creatable
                           menuPortalTarget={document.body}
                           options={options}
-                          value={{ value: sourceRef, label: sourceRef }}
+                          value={{ value: sourceRef, label: selectedLabel }}
                           onChange={(e) => {
                             this.props.dispatch({
                               type: SOURCEPRIOS_PRIO_CHANGED,
@@ -421,6 +426,7 @@ class SourcePriorities extends Component {
                         dispatch={this.props.dispatch}
                         isSaving={this.props.saveState.isSaving}
                         pathIndex={index}
+                        devices={this.props.devices}
                       />
                     </td>
                     <td style={{ border: 'none' }}>
@@ -478,9 +484,10 @@ class SourcePriorities extends Component {
   }
 }
 
-const mapStateToProps = ({ sourcePrioritiesData }) => ({
+const mapStateToProps = ({ sourcePrioritiesData, serverStatistics }) => ({
   sourcePriorities: sourcePrioritiesData.sourcePriorities,
-  saveState: sourcePrioritiesData.saveState
+  saveState: sourcePrioritiesData.saveState,
+  devices: serverStatistics?.devices || []
 })
 
 export default connect(mapStateToProps)(SourcePriorities)
diff --git a/src/deltastats.ts b/src/deltastats.ts
index 9e167b1bd..5fb8e65d3 100644
--- a/src/deltastats.ts
+++ b/src/deltastats.ts
@@ -74,13 +74,22 @@ export function startDeltaStatistics(
     updateProviderPeriodStats(app)
     const anyApp = app as any
     const config = getSecurityConfig(anyApp)
-    let devices = []
+    // Only include clientId and description for display purposes
+    // Do NOT include permissions or other sensitive device info
+    // as this is broadcast to all connected clients including readonly users
+    let devices: Array<{ clientId: string; description: string }> = []
     if (
       anyApp &&
       anyApp.securityStrategy &&
       typeof anyApp.securityStrategy.getDevices === 'function'
     ) {
-      devices = anyApp.securityStrategy.getDevices(config)
+      const allDevices = anyApp.securityStrategy.getDevices(config) || []
+      devices = allDevices.map(
+        (d: { clientId: string; description?: string }) => ({
+          clientId: d.clientId,
+          description: d.description || ''
+        })
+      )
     }
     app.emit('serverevent', {
       type: 'SERVERSTATISTICS',

From c93f77ff7a2d6c8f8f90a32042302ef6870c3258 Mon Sep 17 00:00:00 2001
From: KEGustafsson <ke.gustafsson@gmail.com>
Date: Mon, 15 Dec 2025 14:53:26 +0200
Subject: [PATCH 5/8] feat: select human readable wd device names or id

---
 .../src/views/Dashboard/Dashboard.js          | 14 +++---
 .../src/views/DataBrowser/DataBrowser.js      | 24 +++++++---
 .../views/ServerConfig/SourcePriorities.js    | 44 ++++++++++++++-----
 .../src/views/security/Settings.js            | 30 +++++++++++++
 src/deltastats.ts                             | 21 ++++-----
 src/security.ts                               |  1 +
 6 files changed, 100 insertions(+), 34 deletions(-)

diff --git a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
index c716e6a9d..e832159f8 100644
--- a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
+++ b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
@@ -10,7 +10,6 @@ import {
   Table
 } from 'reactstrap'
 import '../../fa-pulse.css'
-import { getWsDeviceDisplayName } from '../../utils/wsDeviceUtils'
 
 const Dashboard = (props) => {
   const {
@@ -69,7 +68,11 @@ const Dashboard = (props) => {
   }
 
   const renderActivity = (providerId, providerStats, linkType) => {
-    const displayName = getWsDeviceDisplayName(providerId, devices)
+    let device = providerId
+    if (providerId.startsWith('ws.')) {
+      const found = devices.find((d) => d.clientId === providerId.slice(3))
+      device = found && found.description ? found.description : providerId
+    }
     return (
       <li key={providerId} onClick={() => props.history.push(`/dashboard`)}>
         <i
@@ -88,7 +91,7 @@ const Dashboard = (props) => {
         <span className="title">
           {linkType === 'plugin'
             ? pluginNameLink(providerId)
-            : providerIdLink(providerId, displayName)}
+            : providerIdLink(providerId, device)}
         </span>
         {providerStats.writeRate > 0 && (
           <span className="value">
@@ -126,7 +129,6 @@ const Dashboard = (props) => {
   }
 
   const renderStatus = (status, statusClass, lastError) => {
-    const displayName = getWsDeviceDisplayName(status.id, devices)
     return (
       <tr
         key={status.id}
@@ -141,7 +143,7 @@ const Dashboard = (props) => {
         <td>
           {status.statusType === 'plugin'
             ? pluginNameLink(status.id)
-            : providerIdLink(status.id, displayName)}
+            : providerIdLink(status.id)}
         </td>
         <td>
           <p className="text-danger">{lastError}</p>
@@ -149,7 +151,7 @@ const Dashboard = (props) => {
         <td>
           <p className={statusClass}>
             {(status.message || '').substring(0, 80)}
-            {(status.message || '').length > 80 ? '...' : ''}
+            {status.message.length > 80 ? '...' : ''}
           </p>
         </td>
       </tr>
diff --git a/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js b/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
index ffa4d7924..2bf7a7af1 100644
--- a/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
+++ b/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
@@ -17,7 +17,6 @@ import moment from 'moment'
 import { CopyToClipboard } from 'react-copy-to-clipboard'
 import Meta from './Meta'
 import { getValueRenderer, DefaultValueRenderer } from './ValueRenderers'
-import { getSourceDisplayName } from '../../utils/wsDeviceUtils'
 
 const TIMESTAMP_FORMAT = 'MM/DD HH:mm:ss'
 const TIME_ONLY_FORMAT = 'HH:mm:ss'
@@ -341,6 +340,24 @@ class DataBrowser extends Component {
     })
   }
 
+  getSourceDisplayName(source) {
+    const { serverStatistics } = this.props
+    const devices = serverStatistics?.devices || []
+
+    if (source && source.startsWith('ws.')) {
+      // Find device where source matches ws.<clientId> or starts with ws.<clientId>.
+      const device = devices.find(
+        (d) =>
+          source === `ws.${d.clientId}` ||
+          source.startsWith(`ws.${d.clientId}.`)
+      )
+      if (device && device.description) {
+        return device.description
+      }
+    }
+    return source
+  }
+
   render() {
     const contextOptions = this.getContextOptions()
     const currentContext = this.getCurrentContextValue()
@@ -737,10 +754,7 @@ class DataBrowser extends Component {
                                   }}
                                 />
                                 <CopyToClipboardWithFade text={data.$source}>
-                                  {getSourceDisplayName(
-                                    data.$source,
-                                    this.props.serverStatistics?.devices
-                                  )}{' '}
+                                  {this.getSourceDisplayName(data.$source)}{' '}
                                   <i className="far fa-copy"></i>
                                 </CopyToClipboardWithFade>{' '}
                                 {data.pgn || ''}
diff --git a/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js b/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
index 5b3d1992a..6163daa9f 100644
--- a/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
+++ b/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
@@ -15,7 +15,6 @@ import {
 import Creatable from 'react-select/creatable'
 import remove from 'lodash.remove'
 import uniq from 'lodash.uniq'
-import { getSourceDisplayName } from '../../utils/wsDeviceUtils'
 
 export const SOURCEPRIOS_PRIO_CHANGED = 'SOURCEPRIOS_PPRIO_CHANGED'
 export const SOURCEPRIOS_PRIO_DELETED = 'SOURCEPRIOS_PRIO_DELETED'
@@ -190,14 +189,13 @@ class PrefsEditor extends Component {
             <tbody>
               {[...this.props.priorities, { sourceRef: '', timeout: '' }].map(
                 ({ sourceRef, timeout }, index) => {
-                  const options = this.state.sourceRefs.map((ref) => ({
-                    label: getSourceDisplayName(ref, this.props.devices),
-                    value: ref
+                  const { getSourceDisplayLabel } = this.props
+                  const options = this.state.sourceRefs.map((sourceRef) => ({
+                    label: getSourceDisplayLabel
+                      ? getSourceDisplayLabel(sourceRef)
+                      : sourceRef,
+                    value: sourceRef
                   }))
-                  const selectedLabel = getSourceDisplayName(
-                    sourceRef,
-                    this.props.devices
-                  )
                   return (
                     <tr key={index}>
                       <td>{index + 1}.</td>
@@ -205,7 +203,12 @@ class PrefsEditor extends Component {
                         <Creatable
                           menuPortalTarget={document.body}
                           options={options}
-                          value={{ value: sourceRef, label: selectedLabel }}
+                          value={{
+                            value: sourceRef,
+                            label: getSourceDisplayLabel
+                              ? getSourceDisplayLabel(sourceRef)
+                              : sourceRef
+                          }}
                           onChange={(e) => {
                             this.props.dispatch({
                               type: SOURCEPRIOS_PRIO_CHANGED,
@@ -363,6 +366,25 @@ class SourcePriorities extends Component {
         }))
       })
     })
+    this.getSourceDisplayLabel = this.getSourceDisplayLabel.bind(this)
+  }
+
+  getSourceDisplayLabel(sourceRef) {
+    const { serverStatistics } = this.props
+    const devices = serverStatistics?.devices || []
+
+    if (sourceRef && sourceRef.startsWith('ws.')) {
+      // Find device where sourceRef matches ws.<clientId> or starts with ws.<clientId>.
+      const device = devices.find(
+        (d) =>
+          sourceRef === `ws.${d.clientId}` ||
+          sourceRef.startsWith(`ws.${d.clientId}.`)
+      )
+      if (device && device.description) {
+        return device.description
+      }
+    }
+    return sourceRef
   }
 
   render() {
@@ -426,7 +448,7 @@ class SourcePriorities extends Component {
                         dispatch={this.props.dispatch}
                         isSaving={this.props.saveState.isSaving}
                         pathIndex={index}
-                        devices={this.props.devices}
+                        getSourceDisplayLabel={this.getSourceDisplayLabel}
                       />
                     </td>
                     <td style={{ border: 'none' }}>
@@ -487,7 +509,7 @@ class SourcePriorities extends Component {
 const mapStateToProps = ({ sourcePrioritiesData, serverStatistics }) => ({
   sourcePriorities: sourcePrioritiesData.sourcePriorities,
   saveState: sourcePrioritiesData.saveState,
-  devices: serverStatistics?.devices || []
+  serverStatistics
 })
 
 export default connect(mapStateToProps)(SourcePriorities)
diff --git a/packages/server-admin-ui/src/views/security/Settings.js b/packages/server-admin-ui/src/views/security/Settings.js
index d28dee4a2..72619b83c 100644
--- a/packages/server-admin-ui/src/views/security/Settings.js
+++ b/packages/server-admin-ui/src/views/security/Settings.js
@@ -69,6 +69,7 @@ class Settings extends Component {
       allowNewUserRegistration: this.state.allowNewUserRegistration,
       allowDeviceAccessRequests: this.state.allowDeviceAccessRequests,
       allowedCorsOrigins: this.state.allowedCorsOrigins,
+      showDeviceLabelNames: this.state.showDeviceLabelNames !== false,
       adminUIOrigin
     }
     fetch(`${window.serverRoutesPrefix}/security/config`, {
@@ -185,6 +186,35 @@ class Settings extends Component {
                         </FormGroup>
                       </Col>
                     </FormGroup>
+                    <FormGroup row>
+                      <Col xs="0" md="3">
+                        <Label>Show Device Names in UI</Label>
+                      </Col>
+                      <Col md="9">
+                        <FormGroup check>
+                          <div>
+                            <Label className="switch switch-text switch-primary">
+                              <Input
+                                type="checkbox"
+                                name="showDeviceLabelNames"
+                                className="switch-input"
+                                onChange={this.handleChange}
+                                checked={this.state.showDeviceLabelNames !== false}
+                              />
+                              <span
+                                className="switch-label"
+                                data-on="Yes"
+                                data-off="No"
+                              ></span>
+                              <span className="switch-handle"></span>
+                            </Label>
+                          </div>
+                        </FormGroup>
+                        <FormText color="muted">
+                          Show device descriptions instead of IDs in Dashboard, Data Browser, and Source Priorities
+                        </FormText>
+                      </Col>
+                    </FormGroup>
                     <FormGroup row>
                       <Col md="3">
                         <Label htmlFor="text-input">Remember Me timeout</Label>
diff --git a/src/deltastats.ts b/src/deltastats.ts
index 5fb8e65d3..98f2fb15b 100644
--- a/src/deltastats.ts
+++ b/src/deltastats.ts
@@ -74,22 +74,18 @@ export function startDeltaStatistics(
     updateProviderPeriodStats(app)
     const anyApp = app as any
     const config = getSecurityConfig(anyApp)
-    // Only include clientId and description for display purposes
-    // Do NOT include permissions or other sensitive device info
-    // as this is broadcast to all connected clients including readonly users
-    let devices: Array<{ clientId: string; description: string }> = []
+    const showDeviceLabelNames = config?.showDeviceLabelNames !== false
+    let devices: any[] = []
     if (
       anyApp &&
       anyApp.securityStrategy &&
       typeof anyApp.securityStrategy.getDevices === 'function'
     ) {
-      const allDevices = anyApp.securityStrategy.getDevices(config) || []
-      devices = allDevices.map(
-        (d: { clientId: string; description?: string }) => ({
-          clientId: d.clientId,
-          description: d.description || ''
-        })
-      )
+      devices = anyApp.securityStrategy.getDevices(config)
+      // Strip descriptions when toggle is OFF so UI shows IDs
+      if (!showDeviceLabelNames) {
+        devices = devices.map((d: any) => ({ ...d, description: undefined }))
+      }
     }
     app.emit('serverevent', {
       type: 'SERVERSTATISTICS',
@@ -102,7 +98,8 @@ export function startDeltaStatistics(
         wsClients: anyApp.interfaces.ws ? anyApp.interfaces.ws.numClients() : 0,
         providerStatistics: app.providerStatistics,
         uptime: process.uptime(),
-        devices: devices
+        devices: devices,
+        showDeviceLabelNames
       }
     })
     app.lastIntervalDeltaCount = app.deltaCount
diff --git a/src/security.ts b/src/security.ts
index 855b4a515..98e809684 100644
--- a/src/security.ts
+++ b/src/security.ts
@@ -104,6 +104,7 @@ export interface SecurityConfig {
   secretKey: string
   users: User[]
   acls?: ACL[]
+  showDeviceLabelNames?: boolean
 }
 
 export interface RequestStatusData {

From 5a130431805bdac72a464c2da504f9f0c0d68fc7 Mon Sep 17 00:00:00 2001
From: KEGustafsson <ke.gustafsson@gmail.com>
Date: Mon, 15 Dec 2025 15:39:58 +0200
Subject: [PATCH 6/8] fix: format

---
 .../src/utils/wsDeviceUtils.js                | 117 ------------------
 .../src/views/security/Settings.js            |   7 +-
 2 files changed, 5 insertions(+), 119 deletions(-)
 delete mode 100644 packages/server-admin-ui/src/utils/wsDeviceUtils.js

diff --git a/packages/server-admin-ui/src/utils/wsDeviceUtils.js b/packages/server-admin-ui/src/utils/wsDeviceUtils.js
deleted file mode 100644
index 35338617a..000000000
--- a/packages/server-admin-ui/src/utils/wsDeviceUtils.js
+++ /dev/null
@@ -1,117 +0,0 @@
-/**
- * Utility functions for WebSocket device name resolution
- *
- * WS device IDs have the format "ws.{clientId}" where the clientId
- * may have dots replaced with underscores. These IDs are not
- * user-friendly, so we provide utilities to resolve them to
- * human-readable device descriptions when available.
- *
- * Note: Delta $source can be composite like "ws.device_id.nmea0183.GGA"
- * where the device part is followed by additional source path info.
- */
-
-/**
- * Converts a device clientId to the format used in WS source IDs
- * by replacing dots with underscores.
- *
- * @param {string} clientId - The device clientId (e.g., "my.device.id")
- * @returns {string} The WS format (e.g., "my_device_id")
- */
-export function clientIdToWsFormat(clientId) {
-  if (!clientId) return ''
-  return clientId.replace(/\./g, '_')
-}
-
-/**
- * Finds a device that matches the given WS source ID.
- * The source ID may be composite (e.g., "ws.device_id.nmea0183.GGA")
- * so we check if any device's clientId matches as a prefix.
- *
- * @param {string} wsSourceId - The WS source ID (e.g., "ws.device_id" or "ws.device_id.path.info")
- * @param {Array} devices - Array of device objects with clientId property
- * @returns {Object|null} The matching device or null
- */
-export function findDeviceByWsSource(wsSourceId, devices) {
-  if (
-    !wsSourceId ||
-    !wsSourceId.startsWith('ws.') ||
-    !devices ||
-    !Array.isArray(devices)
-  ) {
-    return null
-  }
-
-  // Get the part after "ws."
-  const sourceWithoutPrefix = wsSourceId.slice(3)
-
-  // Find a device whose clientId (in ws format) matches the start of the source
-  for (const device of devices) {
-    if (device && device.clientId) {
-      const wsFormatClientId = clientIdToWsFormat(device.clientId)
-      // Check if source starts with this device's ID
-      // Must be exact match or followed by a dot (to avoid partial matches)
-      if (
-        sourceWithoutPrefix === wsFormatClientId ||
-        sourceWithoutPrefix.startsWith(wsFormatClientId + '.')
-      ) {
-        return device
-      }
-    }
-  }
-
-  return null
-}
-
-/**
- * Gets the display name for a WebSocket source ID.
- * Returns the device description if available, otherwise the original ID.
- *
- * @param {string} wsSourceId - The WebSocket source ID (e.g., "ws.device_id" or "ws.device_id.path")
- * @param {Array} devices - Array of device objects with clientId and description
- * @returns {string} The display name (description or original ID)
- */
-export function getWsDeviceDisplayName(wsSourceId, devices) {
-  if (!wsSourceId || !wsSourceId.startsWith('ws.')) {
-    return wsSourceId
-  }
-
-  const device = findDeviceByWsSource(wsSourceId, devices)
-
-  // Return description if it exists and is not empty
-  if (device && device.description && device.description.trim() !== '') {
-    return device.description
-  }
-
-  return wsSourceId
-}
-
-/**
- * Gets the display name for any source ID, handling both WS and non-WS sources.
- * For WS sources, attempts to resolve to device description.
- * For non-WS sources, returns the ID as-is.
- *
- * @param {string} sourceId - The source ID (e.g., "ws.client_123" or "nmea0183-1")
- * @param {Array} devices - Array of device objects (can be null/undefined)
- * @returns {string} The display name
- */
-export function getSourceDisplayName(sourceId, devices) {
-  if (!sourceId) {
-    return sourceId
-  }
-
-  if (sourceId.startsWith('ws.')) {
-    return getWsDeviceDisplayName(sourceId, devices)
-  }
-
-  return sourceId
-}
-
-/**
- * Checks if a source/provider ID is a WebSocket device
- *
- * @param {string} id - The source or provider ID
- * @returns {boolean} True if it's a WebSocket device ID
- */
-export function isWsDevice(id) {
-  return id && typeof id === 'string' && id.startsWith('ws.')
-}
diff --git a/packages/server-admin-ui/src/views/security/Settings.js b/packages/server-admin-ui/src/views/security/Settings.js
index 72619b83c..294840c1a 100644
--- a/packages/server-admin-ui/src/views/security/Settings.js
+++ b/packages/server-admin-ui/src/views/security/Settings.js
@@ -199,7 +199,9 @@ class Settings extends Component {
                                 name="showDeviceLabelNames"
                                 className="switch-input"
                                 onChange={this.handleChange}
-                                checked={this.state.showDeviceLabelNames !== false}
+                                checked={
+                                  this.state.showDeviceLabelNames !== false
+                                }
                               />
                               <span
                                 className="switch-label"
@@ -211,7 +213,8 @@ class Settings extends Component {
                           </div>
                         </FormGroup>
                         <FormText color="muted">
-                          Show device descriptions instead of IDs in Dashboard, Data Browser, and Source Priorities
+                          Show device descriptions instead of IDs in Dashboard,
+                          Data Browser, and Source Priorities
                         </FormText>
                       </Col>
                     </FormGroup>

From 7e52f4a56132d2e3eb771cbef9ba743cddb0f750 Mon Sep 17 00:00:00 2001
From: KE Gustafsson <ke.gustafsson@gmail.com>
Date: Mon, 15 Dec 2025 23:43:19 +0200
Subject: [PATCH 7/8] fix: common utils and security fix

---
 .../server-admin-ui/src/utils/deviceUtils.js  | 20 +++++++++++++++++++
 .../src/views/Dashboard/Dashboard.js          |  7 ++-----
 .../src/views/DataBrowser/DataBrowser.js      | 15 ++------------
 .../views/ServerConfig/SourcePriorities.js    | 15 ++------------
 src/deltastats.ts                             | 11 +++++-----
 5 files changed, 31 insertions(+), 37 deletions(-)
 create mode 100644 packages/server-admin-ui/src/utils/deviceUtils.js

diff --git a/packages/server-admin-ui/src/utils/deviceUtils.js b/packages/server-admin-ui/src/utils/deviceUtils.js
new file mode 100644
index 000000000..5e1407fc7
--- /dev/null
+++ b/packages/server-admin-ui/src/utils/deviceUtils.js
@@ -0,0 +1,20 @@
+/**
+ * Get a display label for a source reference by looking up device descriptions.
+ *
+ * @param {string} sourceRef - The source reference (e.g., 'ws.abc123' or 'ws.abc123.something')
+ * @param {Array} devices - Array of device objects with clientId and description properties
+ * @returns {string} The device description if found, otherwise the original sourceRef
+ */
+export function getDeviceDisplayLabel(sourceRef, devices = []) {
+  if (sourceRef && sourceRef.startsWith('ws.')) {
+    const device = devices.find(
+      (d) =>
+        sourceRef === `ws.${d.clientId}` ||
+        sourceRef.startsWith(`ws.${d.clientId}.`)
+    )
+    if (device && device.description) {
+      return device.description
+    }
+  }
+  return sourceRef
+}
diff --git a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
index e832159f8..f34864fc0 100644
--- a/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
+++ b/packages/server-admin-ui/src/views/Dashboard/Dashboard.js
@@ -10,6 +10,7 @@ import {
   Table
 } from 'reactstrap'
 import '../../fa-pulse.css'
+import { getDeviceDisplayLabel } from '../../util/deviceUtils'
 
 const Dashboard = (props) => {
   const {
@@ -68,11 +69,7 @@ const Dashboard = (props) => {
   }
 
   const renderActivity = (providerId, providerStats, linkType) => {
-    let device = providerId
-    if (providerId.startsWith('ws.')) {
-      const found = devices.find((d) => d.clientId === providerId.slice(3))
-      device = found && found.description ? found.description : providerId
-    }
+    const device = getDeviceDisplayLabel(providerId, devices)
     return (
       <li key={providerId} onClick={() => props.history.push(`/dashboard`)}>
         <i
diff --git a/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js b/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
index 2bf7a7af1..4129f8c82 100644
--- a/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
+++ b/packages/server-admin-ui/src/views/DataBrowser/DataBrowser.js
@@ -17,6 +17,7 @@ import moment from 'moment'
 import { CopyToClipboard } from 'react-copy-to-clipboard'
 import Meta from './Meta'
 import { getValueRenderer, DefaultValueRenderer } from './ValueRenderers'
+import { getDeviceDisplayLabel } from '../../util/deviceUtils'
 
 const TIMESTAMP_FORMAT = 'MM/DD HH:mm:ss'
 const TIME_ONLY_FORMAT = 'HH:mm:ss'
@@ -343,19 +344,7 @@ class DataBrowser extends Component {
   getSourceDisplayName(source) {
     const { serverStatistics } = this.props
     const devices = serverStatistics?.devices || []
-
-    if (source && source.startsWith('ws.')) {
-      // Find device where source matches ws.<clientId> or starts with ws.<clientId>.
-      const device = devices.find(
-        (d) =>
-          source === `ws.${d.clientId}` ||
-          source.startsWith(`ws.${d.clientId}.`)
-      )
-      if (device && device.description) {
-        return device.description
-      }
-    }
-    return source
+    return getDeviceDisplayLabel(source, devices)
   }
 
   render() {
diff --git a/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js b/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
index 6163daa9f..ac153bc8c 100644
--- a/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
+++ b/packages/server-admin-ui/src/views/ServerConfig/SourcePriorities.js
@@ -15,6 +15,7 @@ import {
 import Creatable from 'react-select/creatable'
 import remove from 'lodash.remove'
 import uniq from 'lodash.uniq'
+import { getDeviceDisplayLabel } from '../../util/deviceUtils'
 
 export const SOURCEPRIOS_PRIO_CHANGED = 'SOURCEPRIOS_PPRIO_CHANGED'
 export const SOURCEPRIOS_PRIO_DELETED = 'SOURCEPRIOS_PRIO_DELETED'
@@ -372,19 +373,7 @@ class SourcePriorities extends Component {
   getSourceDisplayLabel(sourceRef) {
     const { serverStatistics } = this.props
     const devices = serverStatistics?.devices || []
-
-    if (sourceRef && sourceRef.startsWith('ws.')) {
-      // Find device where sourceRef matches ws.<clientId> or starts with ws.<clientId>.
-      const device = devices.find(
-        (d) =>
-          sourceRef === `ws.${d.clientId}` ||
-          sourceRef.startsWith(`ws.${d.clientId}.`)
-      )
-      if (device && device.description) {
-        return device.description
-      }
-    }
-    return sourceRef
+    return getDeviceDisplayLabel(sourceRef, devices)
   }
 
   render() {
diff --git a/src/deltastats.ts b/src/deltastats.ts
index 98f2fb15b..f93df4407 100644
--- a/src/deltastats.ts
+++ b/src/deltastats.ts
@@ -75,17 +75,16 @@ export function startDeltaStatistics(
     const anyApp = app as any
     const config = getSecurityConfig(anyApp)
     const showDeviceLabelNames = config?.showDeviceLabelNames !== false
-    let devices: any[] = []
+    let devices: { clientId: string; description?: string }[] = []
     if (
       anyApp &&
       anyApp.securityStrategy &&
       typeof anyApp.securityStrategy.getDevices === 'function'
     ) {
-      devices = anyApp.securityStrategy.getDevices(config)
-      // Strip descriptions when toggle is OFF so UI shows IDs
-      if (!showDeviceLabelNames) {
-        devices = devices.map((d: any) => ({ ...d, description: undefined }))
-      }
+      devices = anyApp.securityStrategy.getDevices(config).map((d: any) => ({
+        clientId: d.clientId,
+        description: showDeviceLabelNames ? d.description : undefined
+      }))
     }
     app.emit('serverevent', {
       type: 'SERVERSTATISTICS',

From 393b0e39672a1145f10a85b32df9a6786b8621ca Mon Sep 17 00:00:00 2001
From: KE Gustafsson <ke.gustafsson@gmail.com>
Date: Tue, 16 Dec 2025 00:11:17 +0200
Subject: [PATCH 8/8] fix: typo in path

---
 packages/server-admin-ui/src/{utils => util}/deviceUtils.js | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 rename packages/server-admin-ui/src/{utils => util}/deviceUtils.js (100%)

diff --git a/packages/server-admin-ui/src/utils/deviceUtils.js b/packages/server-admin-ui/src/util/deviceUtils.js
similarity index 100%
rename from packages/server-admin-ui/src/utils/deviceUtils.js
rename to packages/server-admin-ui/src/util/deviceUtils.js
